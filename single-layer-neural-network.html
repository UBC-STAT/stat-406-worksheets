<!DOCTYPE html>
<html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<title>19 Single layer neural network | UBC Stat 406 Worksheets</title>
<meta name="author" content="Daniel J. McDonald and Matías Salibán-Barrera">
<meta name="description" content="This example using the ISOLET data illustrates the use of simple neural networks (NNs), and also highlights some issues of which it may be important to be aware. As we discussed in class, NNs...">
<meta name="generator" content="bookdown 0.23 with bs4_book()">
<meta property="og:title" content="19 Single layer neural network | UBC Stat 406 Worksheets">
<meta property="og:type" content="book">
<meta property="og:url" content="https://ubc-stat.github.io/stat-406-worksheets/single-layer-neural-network.html">
<meta property="og:description" content="This example using the ISOLET data illustrates the use of simple neural networks (NNs), and also highlights some issues of which it may be important to be aware. As we discussed in class, NNs...">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="19 Single layer neural network | UBC Stat 406 Worksheets">
<meta name="twitter:description" content="This example using the ISOLET data illustrates the use of simple neural networks (NNs), and also highlights some issues of which it may be important to be aware. As we discussed in class, NNs...">
<!-- JS --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://kit.fontawesome.com/6ecbd6c532.js" crossorigin="anonymous"></script><script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<link href="libs/bootstrap-4.6.0/bootstrap.min.css" rel="stylesheet">
<script src="libs/bootstrap-4.6.0/bootstrap.bundle.min.js"></script><script src="libs/bs3compat-0.2.5.1/tabs.js"></script><script src="libs/bs3compat-0.2.5.1/bs3compat.js"></script><link href="libs/bs4_book-1.0.0/bs4_book.css" rel="stylesheet">
<script src="libs/bs4_book-1.0.0/bs4_book.js"></script><script src="libs/accessible-code-block-0.0.1/empty-anchor.js"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- CSS -->
</head>
<body data-spy="scroll" data-target="#toc">

<div class="container-fluid">
<div class="row">
  <header class="col-sm-12 col-lg-3 sidebar sidebar-book"><a class="sr-only sr-only-focusable" href="#content">Skip to main content</a>

    <div class="d-flex align-items-start justify-content-between">
      <h1>
        <a href="index.html" title="">UBC Stat 406 Worksheets</a>
      </h1>
      <button class="btn btn-outline-primary d-lg-none ml-2 mt-1" type="button" data-toggle="collapse" data-target="#main-nav" aria-expanded="true" aria-controls="main-nav"><i class="fas fa-bars"></i><span class="sr-only">Show table of contents</span></button>
    </div>

    <div id="main-nav" class="collapse-lg">
      <form role="search">
        <input id="search" class="form-control" type="search" placeholder="Search" aria-label="Search">
</form>

      <nav aria-label="Table of contents"><h2>Table of contents</h2>
        <ul class="book-toc list-unstyled">
<li><a class="" href="index.html">Stat 406 Worksheets</a></li>
<li><a class="" href="preface.html">Preface</a></li>
<li class="book-part">Module 0 – Review</li>
<li><a class="" href="predictions-using-a-linear-model.html"><span class="header-section-number">1</span> Predictions using a linear model</a></li>
<li class="book-part">Module 1 – Model Selection</li>
<li><a class="" href="predictions-using-a-linear-model-continued.html"><span class="header-section-number">2</span> Predictions using a linear model (continued)</a></li>
<li><a class="" href="cross-validation-concerns.html"><span class="header-section-number">3</span> Cross-validation concerns</a></li>
<li><a class="" href="comparing-models.html"><span class="header-section-number">4</span> Comparing models</a></li>
<li class="book-part">Module 2 – Regression</li>
<li><a class="" href="ridge-regression.html"><span class="header-section-number">5</span> Ridge regression</a></li>
<li><a class="" href="lasso.html"><span class="header-section-number">6</span> LASSO</a></li>
<li><a class="" href="non-parametric-regression.html"><span class="header-section-number">7</span> Non-parametric regression</a></li>
<li><a class="" href="kernel-regression-local-regression.html"><span class="header-section-number">8</span> Kernel regression / local regression</a></li>
<li><a class="" href="regression-trees.html"><span class="header-section-number">9</span> Regression trees</a></li>
<li><a class="" href="pruning-regression-trees-with-rpart.html"><span class="header-section-number">10</span> Pruning regression trees with rpart</a></li>
<li class="book-part">Module 3 – Classification</li>
<li><a class="" href="parametric-classifiers.html"><span class="header-section-number">11</span> Parametric classifiers</a></li>
<li><a class="" href="qda.html"><span class="header-section-number">12</span> QDA</a></li>
<li><a class="" href="classification-trees.html"><span class="header-section-number">13</span> Classification Trees</a></li>
<li><a class="" href="bagging-for-regression.html"><span class="header-section-number">14</span> Bagging for regression</a></li>
<li><a class="" href="bagging-for-classification.html"><span class="header-section-number">15</span> Bagging for classification</a></li>
<li><a class="" href="random-forests.html"><span class="header-section-number">16</span> Random Forests</a></li>
<li><a class="" href="boosting-a-statistical-learning-perspective.html"><span class="header-section-number">17</span> Boosting (a Statistical Learning perspective)</a></li>
<li><a class="" href="what-is-adaboost-doing-really.html"><span class="header-section-number">18</span> What is Adaboost doing, really?</a></li>
<li><a class="active" href="single-layer-neural-network.html"><span class="header-section-number">19</span> Single layer neural network</a></li>
<li class="book-part">Module 5 – Unsupervised learning</li>
<li><a class="" href="introduction.html"><span class="header-section-number">20</span> Introduction</a></li>
<li><a class="" href="clustering.html"><span class="header-section-number">21</span> Clustering</a></li>
<li><a class="" href="model-based-clustering.html"><span class="header-section-number">22</span> Model based clustering</a></li>
<li><a class="" href="hierarchical-clustering.html"><span class="header-section-number">23</span> Hierarchical clustering</a></li>
<li><a class="" href="references.html">References</a></li>
<li class="book-part">Appendix</li>
<li><a class="" href="alt-pca.html"><span class="header-section-number">A</span> PCA and alternating regression</a></li>
</ul>

        <div class="book-extra">
          <p><a id="book-repo" href="https://github.com/ubc-stat/stat-406-worksheets">View book source <i class="fab fa-github"></i></a></p>
        </div>
      </nav>
</div>
  </header><main class="col-sm-12 col-md-9 col-lg-7" id="content"><div id="single-layer-neural-network" class="section level1">
<h1>
<span class="header-section-number">19</span> Single layer neural network<a class="anchor" aria-label="anchor" href="#single-layer-neural-network"><i class="fas fa-link"></i></a>
</h1>
<p>This example using the ISOLET data illustrates the use of simple
neural networks (NNs), and also highlights some issues of which it may
be important to be aware. As we discussed in class, NNs typically have
more parameters than observations and a number of tuning parameters
that need to be chosen by the user. Among these: the number of
hidden layers, the number of units in each layer, the <em>activation function</em>,
the <em>loss function</em>, a decaying factor, and the initial point
at which to start the optimization iterations. In the example below we illustrate
some difficulties that can be encountered when trying to find
which tuning parameters to use to train a NN.</p>
<p>In order to focus on the concepts behind NN, we will use the <code>nnet</code>
package in <code>R</code>. This package is a very simple implementation
of NNs with a single hidden layer, and relies on standard optimization
algorithms to train it. Such simple setting will allow us to
separate implementation / optimization issues from the underlying
model and ideas behind NN, which carry over naturally to more
complex NNs.</p>
<p>For our example we will use again the ISOLET data which is available here: <a href="http://archive.ics.uci.edu/ml/datasets/ISOLET">http://archive.ics.uci.edu/ml/datasets/ISOLET</a>, along with more information about it. It contains data on sound recordings of 150 speakers saying each letter of the alphabet (twice). See the original source for more details. The full data file is rather large and available in compressed form.
Instead, we will read it from a private copy in plain text form I made
available on Dropbox.</p>
<div id="c-and-z" class="section level2">
<h2>
<span class="header-section-number">19.1</span> “C” and “Z”<a class="anchor" aria-label="anchor" href="#c-and-z"><i class="fas fa-link"></i></a>
</h2>
<p>First we look at building a classifier to identify the letters C and Z. This
is the simplest scenario and it will help us fix ideas. We now read the
full data set, and extract the training and test rows corresponding to those
two letters:</p>
<div class="sourceCode" id="cb263"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="http://www.stats.ox.ac.uk/pub/MASS4/">nnet</a></span><span class="op">)</span>
<span class="va">xx.tr</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"data/isolet-train.RDS"</span><span class="op">)</span>
<span class="va">xx.te</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/readRDS.html">readRDS</a></span><span class="op">(</span><span class="st">"data/isolet-test.RDS"</span><span class="op">)</span>
<span class="va">lets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">26</span><span class="op">)</span>
<span class="va">LETTERS</span><span class="op">[</span><span class="va">lets</span><span class="op">]</span>
<span class="co">#&gt; [1] "C" "Z"</span>
<span class="co"># Training set</span>
<span class="va">x.tr</span> <span class="op">&lt;-</span> <span class="va">xx.tr</span><span class="op">[</span><span class="va">xx.tr</span><span class="op">$</span><span class="va">V618</span> <span class="op">%in%</span> <span class="va">lets</span>, <span class="op">]</span>
<span class="va">x.tr</span><span class="op">$</span><span class="va">V618</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">x.tr</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co"># Test set</span>
<span class="va">x.te</span> <span class="op">&lt;-</span> <span class="va">xx.te</span><span class="op">[</span><span class="va">xx.te</span><span class="op">$</span><span class="va">V618</span> <span class="op">%in%</span> <span class="va">lets</span>, <span class="op">]</span>
<span class="va">truth</span> <span class="op">&lt;-</span> <span class="va">x.te</span><span class="op">$</span><span class="va">V618</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">x.te</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span></code></pre></div>
<p>We train a NN with a single hidden layer, and a single unit in the hidden layer.</p>
<div class="sourceCode" id="cb264"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">a1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html">nnet</a></span><span class="op">(</span><span class="va">V618</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">x.tr</span>, size <span class="op">=</span> <span class="fl">1</span>, decay <span class="op">=</span> <span class="fl">0</span>, maxit <span class="op">=</span> <span class="fl">1500</span>, MaxNWts <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span>
<span class="co">#&gt; # weights:  620</span>
<span class="co">#&gt; initial  value 350.425020 </span>
<span class="co">#&gt; iter  10 value 41.176789</span>
<span class="co">#&gt; iter  20 value 18.095256</span>
<span class="co">#&gt; iter  30 value 18.052107</span>
<span class="co">#&gt; iter  40 value 18.050646</span>
<span class="co">#&gt; iter  50 value 18.050036</span>
<span class="co">#&gt; iter  60 value 18.048042</span>
<span class="co">#&gt; iter  70 value 12.957465</span>
<span class="co">#&gt; iter  80 value 6.911301</span>
<span class="co">#&gt; iter  90 value 6.483378</span>
<span class="co">#&gt; iter 100 value 6.482803</span>
<span class="co">#&gt; iter 110 value 6.482259</span>
<span class="co">#&gt; iter 120 value 6.438838</span>
<span class="co">#&gt; iter 130 value 0.016676</span>
<span class="co">#&gt; iter 140 value 0.000353</span>
<span class="co">#&gt; final  value 0.000089 </span>
<span class="co">#&gt; converged</span></code></pre></div>
<p>Note the slow convergence. The final value of the objective value was:</p>
<div class="sourceCode" id="cb265"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a1</span><span class="op">$</span><span class="va">value</span>
<span class="co">#&gt; [1] 8.892923e-05</span></code></pre></div>
<p>The error rate on the training set (“goodness of fit”) is</p>
<div class="sourceCode" id="cb266"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">b1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">a1</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="co"># , type='raw')</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b1</span> <span class="op">!=</span> <span class="va">x.tr</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co">#&gt; [1] 0</span></code></pre></div>
<p>We see that this NN fits the training set perfectly. Is this desirable?</p>
<p>We now run the algorithm again, with a different starting point.</p>
<div class="sourceCode" id="cb267"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">456</span><span class="op">)</span>
<span class="va">a2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html">nnet</a></span><span class="op">(</span><span class="va">V618</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">x.tr</span>, size <span class="op">=</span> <span class="fl">1</span>, decay <span class="op">=</span> <span class="fl">0</span>, maxit <span class="op">=</span> <span class="fl">1500</span>, MaxNWts <span class="op">=</span> <span class="fl">2000</span><span class="op">)</span>
<span class="co">#&gt; # weights:  620</span>
<span class="co">#&gt; initial  value 336.934868 </span>
<span class="co">#&gt; iter  10 value 157.630462</span>
<span class="co">#&gt; iter  20 value 61.525474</span>
<span class="co">#&gt; iter  30 value 48.367802</span>
<span class="co">#&gt; iter  40 value 42.968320</span>
<span class="co">#&gt; iter  50 value 37.599621</span>
<span class="co">#&gt; iter  60 value 36.482005</span>
<span class="co">#&gt; iter  70 value 28.084106</span>
<span class="co">#&gt; iter  80 value 26.862814</span>
<span class="co">#&gt; iter  90 value 26.860026</span>
<span class="co">#&gt; iter 100 value 20.648648</span>
<span class="co">#&gt; iter 110 value 20.412129</span>
<span class="co">#&gt; iter 120 value 20.410641</span>
<span class="co">#&gt; iter 130 value 20.410571</span>
<span class="co">#&gt; iter 140 value 20.410534</span>
<span class="co">#&gt; final  value 20.410528 </span>
<span class="co">#&gt; converged</span></code></pre></div>
<p>Compare
the attained value of the objective and the error rate on the training set
with those above (8.910^{-5} and 0, respectively):</p>
<div class="sourceCode" id="cb268"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a2</span><span class="op">$</span><span class="va">value</span>
<span class="co">#&gt; [1] 20.41053</span>
<span class="va">b2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">a2</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="co"># , type='raw')</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b2</span> <span class="op">!=</span> <span class="va">x.tr</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.008333333</span></code></pre></div>
<p>So, we see that the second run of NN produces a much worse solution.
How are their performances on the test set?</p>
<div class="sourceCode" id="cb269"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">b1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">a1</span>, newdata <span class="op">=</span> <span class="va">x.te</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="co"># , type='raw')</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b1</span> <span class="op">!=</span> <span class="va">x.te</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.025</span>
<span class="va">b2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">a2</span>, newdata <span class="op">=</span> <span class="va">x.te</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="co"># , type='raw')</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b2</span> <span class="op">!=</span> <span class="va">x.te</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.04166667</span></code></pre></div>
<p>The second (worse) solution performs better on the test set.</p>
<p>What if we add more units to the hidden layer? We increase the
number of units on the hidden layer from 3 to 6.</p>
<div class="sourceCode" id="cb270"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">a1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html">nnet</a></span><span class="op">(</span><span class="va">V618</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">x.tr</span>, size <span class="op">=</span> <span class="fl">3</span>, decay <span class="op">=</span> <span class="fl">0</span>, maxit <span class="op">=</span> <span class="fl">1500</span>, MaxNWts <span class="op">=</span> <span class="fl">2000</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">456</span><span class="op">)</span>
<span class="va">a2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html">nnet</a></span><span class="op">(</span><span class="va">V618</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">x.tr</span>, size <span class="op">=</span> <span class="fl">3</span>, decay <span class="op">=</span> <span class="fl">0</span>, maxit <span class="op">=</span> <span class="fl">1500</span>, MaxNWts <span class="op">=</span> <span class="fl">2000</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></code></pre></div>
<p>The objective functions are</p>
<div class="sourceCode" id="cb271"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">a1</span><span class="op">$</span><span class="va">value</span>
<span class="co">#&gt; [1] 6.482738</span>
<span class="va">a2</span><span class="op">$</span><span class="va">value</span>
<span class="co">#&gt; [1] 9.052402e-05</span></code></pre></div>
<p>respectively, and their performance on the training and test sets are:</p>
<div class="sourceCode" id="cb272"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">b1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">a1</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="co"># , type='raw')</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b1</span> <span class="op">!=</span> <span class="va">x.tr</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.002083333</span>
<span class="va">b2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">a2</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="co"># , type='raw')</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b2</span> <span class="op">!=</span> <span class="va">x.tr</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co">#&gt; [1] 0</span>

<span class="va">b1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">a1</span>, newdata <span class="op">=</span> <span class="va">x.te</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="co"># , type='raw')</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b1</span> <span class="op">!=</span> <span class="va">x.te</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.03333333</span>
<span class="va">b2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">a2</span>, newdata <span class="op">=</span> <span class="va">x.te</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="co"># , type='raw')</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b2</span> <span class="op">!=</span> <span class="va">x.te</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.04166667</span></code></pre></div>
<p>Again we note that the (seemingly much) worse solution (in terms of the objective
function whose optimization defines the NN) performs better
on the test set.</p>
<p>What if we add a decaying factor as a form of regularization?</p>
<div class="sourceCode" id="cb273"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">a1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html">nnet</a></span><span class="op">(</span><span class="va">V618</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">x.tr</span>, size <span class="op">=</span> <span class="fl">3</span>, decay <span class="op">=</span> <span class="fl">0.05</span>, maxit <span class="op">=</span> <span class="fl">500</span>, MaxNWts <span class="op">=</span> <span class="fl">2000</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">a1</span><span class="op">$</span><span class="va">value</span>
<span class="co">#&gt; [1] 5.345279</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">456</span><span class="op">)</span>
<span class="va">a2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html">nnet</a></span><span class="op">(</span><span class="va">V618</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">x.tr</span>, size <span class="op">=</span> <span class="fl">3</span>, decay <span class="op">=</span> <span class="fl">0.05</span>, maxit <span class="op">=</span> <span class="fl">500</span>, MaxNWts <span class="op">=</span> <span class="fl">2000</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">a2</span><span class="op">$</span><span class="va">value</span>
<span class="co">#&gt; [1] 5.345279</span></code></pre></div>
<p>Now the two solutions starting from these random initial values
are the same (the reader is encouraged to
try more random starts). How does this NN do on the training and test sets?</p>
<div class="sourceCode" id="cb274"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">b1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">a1</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="co"># , type='raw')</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b1</span> <span class="op">!=</span> <span class="va">x.tr</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co">#&gt; [1] 0</span>
<span class="va">b1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">a1</span>, newdata <span class="op">=</span> <span class="va">x.te</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="co"># , type='raw')</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b1</span> <span class="op">!=</span> <span class="va">x.te</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.008333333</span></code></pre></div>
<p>Note that this “regularized” solution which corresponds to a
slightly better solution than the worse one above in terms
of objective function (but still much worse than the best ones)
performs noticeably better on the test set. This seem to suggest
that it is not easy to select which of the many local extrema to used
based on the objective function values they attain.</p>
<p>Another tuning parameter we can vary is the number of units
in the hidden layer, which will also increase significantly the
number of possible weight parameters in our model.
The above solution uses 1858 weights. We now add more
units to the hidden layer (6 instead of 3) and increase the limit on
the number of allowable weights to 4000:</p>
<div class="sourceCode" id="cb275"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">a1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html">nnet</a></span><span class="op">(</span><span class="va">V618</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">x.tr</span>, size <span class="op">=</span> <span class="fl">6</span>, decay <span class="op">=</span> <span class="fl">0.05</span>, maxit <span class="op">=</span> <span class="fl">500</span>, MaxNWts <span class="op">=</span> <span class="fl">4000</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">a1</span><span class="op">$</span><span class="va">value</span>
<span class="co">#&gt; [1] 4.777806</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">456</span><span class="op">)</span>
<span class="va">a2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html">nnet</a></span><span class="op">(</span><span class="va">V618</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">x.tr</span>, size <span class="op">=</span> <span class="fl">6</span>, decay <span class="op">=</span> <span class="fl">0.05</span>, maxit <span class="op">=</span> <span class="fl">500</span>, MaxNWts <span class="op">=</span> <span class="fl">4000</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">a2</span><span class="op">$</span><span class="va">value</span>
<span class="co">#&gt; [1] 4.172023</span>
<span class="va">b1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">a1</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="co"># , type='raw')</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b1</span> <span class="op">!=</span> <span class="va">x.tr</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co">#&gt; [1] 0</span>

<span class="va">b2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">a2</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="co"># , type='raw')</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b2</span> <span class="op">!=</span> <span class="va">x.tr</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co">#&gt; [1] 0</span>

<span class="va">b1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">a1</span>, newdata <span class="op">=</span> <span class="va">x.te</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="co"># , type='raw')</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b1</span> <span class="op">!=</span> <span class="va">x.te</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.008333333</span>

<span class="va">b2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">a2</span>, newdata <span class="op">=</span> <span class="va">x.te</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="co"># , type='raw')</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b2</span> <span class="op">!=</span> <span class="va">x.te</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.008333333</span></code></pre></div>
<p>Note that both of these two distinct solutions fit the training set
exactly (0 apparent error rate), and have the same performance
on the test set. We leave it to the reader to perform a more
exhaustive study of the prediction properties of these solutions
using an appropriate CV experiment.</p>
</div>
<div id="more-letters" class="section level2">
<h2>
<span class="header-section-number">19.2</span> More letters<a class="anchor" aria-label="anchor" href="#more-letters"><i class="fas fa-link"></i></a>
</h2>
<p>We now repeat the same exercise above but on a 4-class
setting.</p>
<div class="sourceCode" id="cb276"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">7</span>, <span class="fl">9</span>, <span class="fl">26</span><span class="op">)</span>
<span class="va">x.tr</span> <span class="op">&lt;-</span> <span class="va">xx.tr</span><span class="op">[</span><span class="va">xx.tr</span><span class="op">$</span><span class="va">V618</span> <span class="op">%in%</span> <span class="va">lets</span>, <span class="op">]</span>
<span class="va">x.tr</span><span class="op">$</span><span class="va">V618</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">x.tr</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co"># testing set</span>
<span class="va">x.te</span> <span class="op">&lt;-</span> <span class="va">xx.te</span><span class="op">[</span><span class="va">xx.te</span><span class="op">$</span><span class="va">V618</span> <span class="op">%in%</span> <span class="va">lets</span>, <span class="op">]</span>
<span class="va">truth</span> <span class="op">&lt;-</span> <span class="va">x.te</span><span class="op">$</span><span class="va">V618</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">x.te</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span></code></pre></div>
<p>The following tries show that a NN with
only one unit in the hidden layer does not perform well.
As before, we compare two local minima of the NN training
algorithm. First we show the values of the
corresponding local minima of the objective function, and then
their error rates on the training and test sets.</p>
<div class="sourceCode" id="cb277"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">a1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html">nnet</a></span><span class="op">(</span><span class="va">V618</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">x.tr</span>, size <span class="op">=</span> <span class="fl">1</span>, decay <span class="op">=</span> <span class="fl">0</span>, maxit <span class="op">=</span> <span class="fl">1500</span>, MaxNWts <span class="op">=</span> <span class="fl">2000</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">a1</span><span class="op">$</span><span class="va">value</span>
<span class="co">#&gt; [1] 9.851054e-05</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">456</span><span class="op">)</span>
<span class="va">a2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html">nnet</a></span><span class="op">(</span><span class="va">V618</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">x.tr</span>, size <span class="op">=</span> <span class="fl">1</span>, decay <span class="op">=</span> <span class="fl">0</span>, maxit <span class="op">=</span> <span class="fl">1500</span>, MaxNWts <span class="op">=</span> <span class="fl">2000</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">a2</span><span class="op">$</span><span class="va">value</span>
<span class="co">#&gt; [1] 789.9009</span>
<span class="va">b1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">a1</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="co"># , type='raw')</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b1</span> <span class="op">!=</span> <span class="va">x.tr</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co">#&gt; [1] 0</span>
<span class="va">b2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">a2</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="co"># , type='raw')</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b2</span> <span class="op">!=</span> <span class="va">x.tr</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.4875</span>
<span class="va">b1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">a1</span>, newdata <span class="op">=</span> <span class="va">x.te</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="co"># , type='raw')</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b1</span> <span class="op">!=</span> <span class="va">x.te</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.4458333</span>
<span class="va">b2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">a2</span>, newdata <span class="op">=</span> <span class="va">x.te</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="co"># , type='raw')</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b2</span> <span class="op">!=</span> <span class="va">x.te</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.5041667</span></code></pre></div>
<p>Note that the error rates on the test set are
0.446 and
0.504, which are
very high.
Better results are obtained with 6 units on the hidden layer
and a slightly regularized solution. As before,
use two runs of the training
algorithm and look at the corresponding values of the
objective function, and the error rates
of both NNs on the training and test sets.</p>
<div class="sourceCode" id="cb278"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">a1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html">nnet</a></span><span class="op">(</span><span class="va">V618</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">x.tr</span>, size <span class="op">=</span> <span class="fl">6</span>, decay <span class="op">=</span> <span class="fl">0.05</span>, maxit <span class="op">=</span> <span class="fl">500</span>, MaxNWts <span class="op">=</span> <span class="fl">4000</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">a1</span><span class="op">$</span><span class="va">value</span>
<span class="co">#&gt; [1] 9.037808</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">456</span><span class="op">)</span>
<span class="va">a2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html">nnet</a></span><span class="op">(</span><span class="va">V618</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">x.tr</span>, size <span class="op">=</span> <span class="fl">6</span>, decay <span class="op">=</span> <span class="fl">0.05</span>, maxit <span class="op">=</span> <span class="fl">500</span>, MaxNWts <span class="op">=</span> <span class="fl">4000</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">a2</span><span class="op">$</span><span class="va">value</span>
<span class="co">#&gt; [1] 9.171046</span>
<span class="va">b1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">a1</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="co"># , type='raw')</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b1</span> <span class="op">!=</span> <span class="va">x.tr</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co">#&gt; [1] 0</span>
<span class="va">b2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">a2</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="co"># , type='raw')</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b2</span> <span class="op">!=</span> <span class="va">x.tr</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co">#&gt; [1] 0</span>
<span class="va">b1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">a1</span>, newdata <span class="op">=</span> <span class="va">x.te</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="co"># , type='raw')</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b1</span> <span class="op">!=</span> <span class="va">x.te</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.0125</span>
<span class="va">b2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">a2</span>, newdata <span class="op">=</span> <span class="va">x.te</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="co"># , type='raw')</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b2</span> <span class="op">!=</span> <span class="va">x.te</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.0125</span></code></pre></div>
<p>The error rates on the test set are now
0.013 and
0.013, which are
much better than before.</p>
</div>
<div id="even-more-letters" class="section level2">
<h2>
<span class="header-section-number">19.3</span> Even more letters<a class="anchor" aria-label="anchor" href="#even-more-letters"><i class="fas fa-link"></i></a>
</h2>
<p>We now consider building a classifier with 7 classes, which
is a more challenging problem.</p>
<div class="sourceCode" id="cb279"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">lets</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="fl">3</span>, <span class="fl">5</span>, <span class="fl">7</span>, <span class="fl">9</span>, <span class="fl">12</span>, <span class="fl">13</span>, <span class="fl">26</span><span class="op">)</span>
<span class="va">LETTERS</span><span class="op">[</span><span class="va">lets</span><span class="op">]</span>
<span class="co">#&gt; [1] "C" "E" "G" "I" "L" "M" "Z"</span>
<span class="va">x.tr</span> <span class="op">&lt;-</span> <span class="va">xx.tr</span><span class="op">[</span><span class="va">xx.tr</span><span class="op">$</span><span class="va">V618</span> <span class="op">%in%</span> <span class="va">lets</span>, <span class="op">]</span>
<span class="va">x.tr</span><span class="op">$</span><span class="va">V618</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">x.tr</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co"># testing set</span>
<span class="va">x.te</span> <span class="op">&lt;-</span> <span class="va">xx.te</span><span class="op">[</span><span class="va">xx.te</span><span class="op">$</span><span class="va">V618</span> <span class="op">%in%</span> <span class="va">lets</span>, <span class="op">]</span>
<span class="va">truth</span> <span class="op">&lt;-</span> <span class="va">x.te</span><span class="op">$</span><span class="va">V618</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html">as.factor</a></span><span class="op">(</span><span class="va">x.te</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span></code></pre></div>
<p>The following code trains a NN with 6 units on the hidden layer and
moderate regularization (via a decaying factor of <code>0.3</code> and
an upper limit of 4000 weights).</p>
<div class="sourceCode" id="cb280"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>
<span class="va">a1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html">nnet</a></span><span class="op">(</span><span class="va">V618</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">x.tr</span>, size <span class="op">=</span> <span class="fl">6</span>, decay <span class="op">=</span> <span class="fl">0.3</span>, maxit <span class="op">=</span> <span class="fl">1500</span>, MaxNWts <span class="op">=</span> <span class="fl">4000</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">a1</span><span class="op">$</span><span class="va">value</span>
<span class="co">#&gt; [1] 102.1805</span>
<span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">456</span><span class="op">)</span>
<span class="va">a2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/pkg/nnet/man/nnet.html">nnet</a></span><span class="op">(</span><span class="va">V618</span> <span class="op">~</span> <span class="va">.</span>, data <span class="op">=</span> <span class="va">x.tr</span>, size <span class="op">=</span> <span class="fl">6</span>, decay <span class="op">=</span> <span class="fl">0.3</span>, maxit <span class="op">=</span> <span class="fl">1500</span>, MaxNWts <span class="op">=</span> <span class="fl">4000</span>, trace <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span>
<span class="va">a2</span><span class="op">$</span><span class="va">value</span>
<span class="co">#&gt; [1] 100.5938</span>
<span class="va">b1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">a1</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="co"># , type='raw')</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b1</span> <span class="op">!=</span> <span class="va">x.tr</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co">#&gt; [1] 0</span>
<span class="va">b2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">a2</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="co"># , type='raw')</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b2</span> <span class="op">!=</span> <span class="va">x.tr</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co">#&gt; [1] 0</span>
<span class="va">b1</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">a1</span>, newdata <span class="op">=</span> <span class="va">x.te</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="co"># , type='raw')</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b1</span> <span class="op">!=</span> <span class="va">x.te</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.01909308</span>
<span class="va">b2</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/stats/predict.html">predict</a></span><span class="op">(</span><span class="va">a2</span>, newdata <span class="op">=</span> <span class="va">x.te</span>, type <span class="op">=</span> <span class="st">"class"</span><span class="op">)</span> <span class="co"># , type='raw')</span>
<span class="fu"><a href="https://rdrr.io/r/base/mean.html">mean</a></span><span class="op">(</span><span class="va">b2</span> <span class="op">!=</span> <span class="va">x.te</span><span class="op">$</span><span class="va">V618</span><span class="op">)</span>
<span class="co">#&gt; [1] 0.01193317</span></code></pre></div>
<p>Note that in this case the NN with a better objective
function (100.5938058 versus 102.1805371) achieves a better performance on
the test set (0.012
versus 0.019), although the
difference is rather small. Conclusions based on a
proper CV study would be much more reliable.</p>
<p>You are strongly encouraged to study what happens with other
combinations of decay, number of weights and number of units
on the hidden layer, using a proper CV setting to evaluate
the results.</p>
<!-- #### Additional resources for discussion (refer to the lecture for context) -->
<!-- * [https://arxiv.org/abs/1412.6572](https://arxiv.org/abs/1412.6572) -->
<!-- * [https://arxiv.org/abs/1312.6199](https://arxiv.org/abs/1312.6199) -->
<!-- * [https://www.axios.com/ai-pioneer-advocates-starting-over-2485537027.html](https://www.axios.com/ai-pioneer-advocates-starting-over-2485537027.html) -->
<!-- * [https://medium.com/intuitionmachine/the-deeply-suspicious-nature-of-backpropagation-9bed5e2b085e](https://medium.com/intuitionmachine/the-deeply-suspicious-nature-of-backpropagation-9bed5e2b085e) -->

</div>
</div>



  <div class="chapter-nav">
<div class="prev"><a href="what-is-adaboost-doing-really.html"><span class="header-section-number">18</span> What is Adaboost doing, really?</a></div>
<div class="next"><a href="introduction.html"><span class="header-section-number">20</span> Introduction</a></div>
</div></main><div class="col-md-3 col-lg-2 d-none d-md-block sidebar sidebar-chapter">
    <nav id="toc" data-toggle="toc" aria-label="On this page"><h2>On this page</h2>
      <ul class="nav navbar-nav">
<li><a class="nav-link" href="#single-layer-neural-network"><span class="header-section-number">19</span> Single layer neural network</a></li>
<li><a class="nav-link" href="#c-and-z"><span class="header-section-number">19.1</span> “C” and “Z”</a></li>
<li><a class="nav-link" href="#more-letters"><span class="header-section-number">19.2</span> More letters</a></li>
<li><a class="nav-link" href="#even-more-letters"><span class="header-section-number">19.3</span> Even more letters</a></li>
</ul>

      <div class="book-extra">
        <ul class="list-unstyled">
<li><a id="book-source" href="https://github.com/ubc-stat/stat-406-worksheets/blob/main/45-single-layer-nn.Rmd">View source <i class="fab fa-github"></i></a></li>
          <li><a id="book-edit" href="https://github.com/ubc-stat/stat-406-worksheets/edit/main/45-single-layer-nn.Rmd">Edit this page <i class="fab fa-github"></i></a></li>
        </ul>
</div>
    </nav>
</div>

</div>
</div> <!-- .container -->

<footer class="bg-primary text-light mt-5"><div class="container"><div class="row">

  <div class="col-12 col-md-6 mt-3">
    <p>"<strong>UBC Stat 406 Worksheets</strong>" was written by Daniel J. McDonald and Matías Salibán-Barrera. It was last built on 2021-08-18.</p>
  </div>

  <div class="col-12 col-md-6 mt-3">
    <p>This book was built by the <a class="text-light" href="https://bookdown.org">bookdown</a> R package.</p>
  </div>

</div></div>
</footer><!-- dynamically load mathjax for compatibility with self-contained --><script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script><script type="text/x-mathjax-config">const popovers = document.querySelectorAll('a.footnote-ref[data-toggle="popover"]');
for (let popover of popovers) {
  const div = document.createElement('div');
  div.setAttribute('style', 'position: absolute; top: 0, left:0; width:0, height:0, overflow: hidden; visibility: hidden;');
  div.innerHTML = popover.getAttribute('data-content');

  var has_math = div.querySelector("span.math");
  if (has_math) {
    document.body.appendChild(div);
    MathJax.Hub.Queue(["Typeset", MathJax.Hub, div]);
    MathJax.Hub.Queue(function() {
      popover.setAttribute('data-content', div.innerHTML);
      document.body.removeChild(div);
    })
  }
}
</script>
</body>
</html>
